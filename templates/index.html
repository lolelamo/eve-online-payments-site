<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="referrer" content="no-referrer">
    <title>Sistema de Pagos EVE Online</title>
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>
    <!-- Floating shapes for background animation -->
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>
    <div class="floating-shape shape-3"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <div>Cargando...</div>
        </div>
    </div>

    <!-- Error Modal (FIXED - was missing) -->
    <div class="error-modal" id="errorModal">
        <div class="error-modal-content">
            <div class="error-modal-header">
                <h2>‚ö†Ô∏è Error</h2>
                <button class="error-modal-close" title="Cerrar">&times;</button>
            </div>
            <div class="error-modal-body">
                <!-- Content filled by JavaScript -->
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>Sistema de Pagos EVE Online</h1>
            <p>Gesti√≥n autom√°tica de distribuci√≥n de ISK por sitios</p>
            <div class="header-badges">
                <div class="badge active" id="autoCalcIndicator">
                    C√°lculo Autom√°tico
                </div>
                <div class="badge" id="dataStatus">
                    Guardado
                </div>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" data-tab="config">
                Configuraci√≥n
            </button>
            <button class="tab" data-tab="members">
                Miembros
                <span class="tab-badge" id="memberBadge">0</span>
            </button>
            <button class="tab" data-tab="sites">
                Sitios
                <span class="tab-badge" id="siteBadge">0</span>
            </button>
        </div>
        
        <div class="content">
            <div class="main-content">
                <!-- TAB 1: CONFIGURATION -->
                <div id="config" class="tab-content active">
                    <div class="section">
                        <h2>‚öôÔ∏è Valores por Nivel de Sitio</h2>
                        <div class="alert">
                            <strong>üí° Consejo:</strong> Define cu√°nto ISK vale cada nivel de sitio (1-10).
                        </div>
                        
                        <!-- Number Format Selector (FIXED) -->
                        <div style="margin-bottom: 25px;">
                            <h3 style="color: #b0b8d4; margin-bottom: 12px; font-size: 1em;">Formato de N√∫meros:</h3>
                            <div class="format-selector">
                                <button class="format-option active" data-format="comma" onclick="setNumberFormat('comma'); return false;">
                                    1,000,000
                                </button>
                                <button class="format-option" data-format="space" onclick="setNumberFormat('space'); return false;">
                                    1 000 000
                                </button>
                                <button class="format-option" data-format="dot" onclick="setNumberFormat('dot'); return false;">
                                    1.000.000
                                </button>
                            </div>
                        </div>
                        
                        <div class="level-grid" id="levelValues"></div>
                        <div class="btn-group">
                            <button class="btn" id="saveConfigBtn">üíæ Guardar Configuraci√≥n</button>
                            <button class="btn btn-secondary" id="resetLevelsBtn">üîÑ Restaurar Valores por Defecto</button>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2>‚≠ê Configuraci√≥n de Salvager</h2>
                        <div class="input-field">
                            <label class="checkbox-label">
                                <input type="checkbox" id="hasSalvager">
                                <span>Hay un salvager que recibe porcentaje extra</span>
                            </label>
                        </div>
                        <div class="input-field" style="margin-top: 15px;">
                            <label>Porcentaje del salvager (%)</label>
                            <input type="number" id="salvagerPercent" value="10" min="0" max="100" disabled>
                            <small style="color: #ccc; margin-top: 5px;">Este porcentaje se distribuye entre todos los salvagers presentes</small>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2>üîß Opciones Generales</h2>
                        <div class="input-field">
                            <label>Moneda</label>
                            <input type="text" id="currency" value="ISK" placeholder="ISK">
                        </div>
                        <div class="input-field" style="margin-top: 15px;">
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoCalculate" checked>
                                <span>Calcular pagos autom√°ticamente al agregar sitios</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2>üì• Importar/Exportar Datos</h2>
                        <div class="btn-group">
                            <button class="btn" id="exportBtn">üì§ Exportar Datos</button>
                            <button class="btn btn-secondary" id="importBtn">üì• Importar Datos</button>
                            <input type="file" id="importFile" accept=".json" style="display: none;">
                        </div>
                    </div>
                </div>
                
                <!-- TAB 2: MEMBERS -->
                <div id="members" class="tab-content">
                    <form class="section" id="memberForm">
                        <h2>Agregar Miembro</h2>
                        <div class="input-group">
                            <div class="input-field">
                                <label>Nombre del Miembro</label>
                                <input type="text" id="memberName" placeholder="Nombre del piloto o m√∫ltiples (separados por coma)" autocomplete="off">
                                <small style="color: #ccc; margin-top: 5px;">Puedes agregar m√∫ltiples nombres separados por comas</small>
                            </div>
                            <div class="input-field">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="isSalvager">
                                    <span>Es salvager</span>
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn">Agregar Miembro</button>
                    </form>
                    
                    <div class="section">
                        <h2>Lista de Miembros (<span id="memberCount">0</span>)</h2>
                        <div id="membersList"></div>
                    </div>
                </div>
                
                <!-- TAB 3: SITES -->
                <div id="sites" class="tab-content">
                    <div class="section">
                        <h2>Registrar Sitio</h2>
                        
                        <div id="noMembersWarning" class="alert alert-warning" style="display: none;">
                            <strong>Atenci√≥n:</strong> Primero debes agregar miembros en la pesta√±a "Miembros".
                        </div>
                        
                        <div class="input-group">
                            <div class="input-field">
                                <label>Nombre del Sitio</label>
                                <input type="text" id="siteName" placeholder="Ej: Sanctum #1">
                            </div>
                            <div class="input-field">
                                <label>Nivel (1-10)</label>
                                <input type="number" id="siteLevel" min="1" max="10" value="1">
                            </div>
                        </div>
                        
                        <h3>Participantes</h3>
                        <div class="select-all-controls">
                            <button class="btn btn-secondary" id="selectAllBtn" type="button">Seleccionar Todos</button>
                            <button class="btn btn-secondary" id="deselectAllBtn" type="button">Deseleccionar Todos</button>
                        </div>
                        <div class="participant-grid" id="participantCheckboxes"></div>
                        
                        <div class="btn-group">
                            <button class="btn" id="addSiteBtn" type="button">Registrar Sitio</button>
                            <button class="btn btn-secondary" id="clearSiteFormBtn" type="button">Limpiar Formulario</button>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h2>Sitios Registrados (<span id="siteCount">0</span>)</h2>
                        <div class="quick-actions">
                            <button class="btn btn-danger" id="clearAllSitesBtn" type="button">Limpiar Todos los Sitios</button>
                        </div>
                        <div id="sitesList"></div>
                    </div>
                </div>
            </div>
            
            <!-- SIDEBAR SUMMARY OF PAYMENTS -->
            <div class="sidebar">
                <h2>Resumen de Pagos</h2>
                
                <div class="stats-card">
                    <h3>Total a Distribuir</h3>
                    <div class="value" id="totalPaid">0 ISK</div>
                </div>
                
                <div class="stats-card">
                    <h3>Sitios Completados</h3>
                    <div class="value" id="totalSites">0</div>
                </div>
                
                <div class="stats-card">
                    <h3>Promedio por Sitio</h3>
                    <div class="value" id="avgPerSite">0 ISK</div>
                </div>
                
                <h3 style="margin: 20px 0 10px 0; color: #4a9eff;">Pagos por Miembro</h3>
                <div id="paymentsList"></div>
            </div>
        </div>
    </div>

    <script src="static/script.js"></script>
</body>
</html>